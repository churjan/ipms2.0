<!-- 主体框架 -->
<zpage #zpage [openLeft]="openLeft" [isLeftSpinning]="isLeftSpinning" [leftTreeTitle]="leftTreeTitle"
    [leftTreeTool]="leftTreeTool" [leftTreeInput]="leftTreeInput" [leftTree]="leftTree" [topInput]="topInput"
    [isAdvancedSearch]="isAdvancedSearch" [zadvancedSearch]="zadvancedSearch" [zadvancedCont]="zadvancedCont"
    [isTablePage]="isTablePage" [tablePage]="tablePage" [tableData]="tableData" [pageSize]="queryParams.pageSize"
    [columns]="columns" [isCheck]="isCheck" [isCheckAll]="isCheckAll" [isNumber]="isNumber" [isOperation]="isOperation"
    [tableLoading]="tableLoading" [format]="format" (topBtn)="getTopBtn($event)" (tableBtn)="getTableBtn($event)"
    (getCheckedIdList)="getCheckedId($event)" (getSortList)="getSortList($event)">
</zpage>

<!-- 左侧树工具栏内容 -->
<ng-template #leftTreeTool>
    <a nz-dropdown nzTrigger="click" class="zleft_top_right_a">
        <i nz-icon nzTheme="outline" nzType="reload" (click)="toReloadTree()"></i>
    </a>
</ng-template>
<!-- 左侧树的查询区域 -->
<ng-template #leftTreeInput>
    <nz-input-group style="margin-bottom: 10px;" [nzSuffix]="suffixIcon">
        <input nz-input [placeholder]="'placard.search'|i18n" [(ngModel)]="searchValue" />
    </nz-input-group>
    <ng-template #suffixIcon>
        <i nz-icon nzType="search"></i>
    </ng-template>
</ng-template>
<!-- 左侧树tree -->
<ng-template #leftTree>
    <nz-tree #ltree [nzData]="nodes" [nzSearchValue]="searchValue" (nzClick)="nzTreeEvent($event)"
        (nzSearchValueChange)="nzEvent($event)" [nzHideUnMatched]="true"></nz-tree>
</ng-template>

<!-- 搜索 -->
<ng-template #topInput>
    <nz-input-group nzSearch [nzSuffix]="suffixIconSearch" [nzAddOnAfter]="suffixButton"
        class="ztop_in_select_in_group">
        <input type="text" nz-input [placeholder]="'placard.keyword_xx'|i18n:('placard.codefullname'|i18n)" [(ngModel)]="queryParams.keywords"
            (keyup.enter)="toSearch(1)" />
    </nz-input-group>
    <ng-template #suffixIconSearch>
        <span nz-icon nzType="search"></span>
    </ng-template>
    <ng-template #suffixButton>
        <button nz-button nzType="primary" nzSearch (click)="toSearch(1)">{{ 'btn.search'|i18n }}</button>
    </ng-template>
    <button nz-button nzType="default" style="margin-left: -2px;" nzSearch (click)="resetQueryParams(1)"><span nz-icon
            nzType="reload"></span>{{ 'btn.reset'|i18n }}</button>
</ng-template>
<!-- 高级搜索 搜索按钮 -->
<ng-template #zadvancedSearch>
    <button nz-button nzType="default" class="zadvanced_search_right_top_left_btn" (click)="toSearch(1)">
        <span nz-icon nzType="search"></span>
        {{ 'btn.search'|i18n }}
    </button>
    <button nz-button nzType="default" class="zadvanced_search_right_top_left_btn" nzSearch
        (click)="resetQueryParams(2)">
        <span nz-icon nzType="reload"></span>
        {{ 'btn.reset'|i18n }}
    </button>
</ng-template>
<!-- 高级搜索 搜索条件 -->
<ng-template #zadvancedCont>
    <div class="zadvanced_search_label">{{ 'popupField.realName'|i18n }}</div>
    <div class="zadvanced_search_input"><input class="zadvanced_search_input_btn" nz-input
            [placeholder]="'inputdata.input'|i18n" [(ngModel)]="queryParams.name" /></div>
    <div class="zadvanced_search_label">{{ 'popupField.jobNo'|i18n }}</div>
    <div class="zadvanced_search_input"><input class="zadvanced_search_input_btn" nz-input
            [placeholder]="'inputdata.input'|i18n" [(ngModel)]="queryParams.code" /></div>
    <div class="zadvanced_search_label">{{ 'popupField.sex'|i18n }}</div>
    <div class="zadvanced_search_input">
        <nz-select class="zadvanced_search_input_btn" [(ngModel)]="queryParams.sex" nzAllowClear
            [nzPlaceHolder]="'checkdata.check'|i18n">
            <nz-option *ngFor="let item of sexList" [nzLabel]="item.name" [nzValue]="item.name"></nz-option>
        </nz-select>
    </div>
    <div class="zadvanced_search_label">{{ 'popupField.timeNo'|i18n }}</div>
    <div class="zadvanced_search_input"><input class="zadvanced_search_input_btn" nz-input
            [placeholder]="'inputdata.input'|i18n" [(ngModel)]="queryParams.attendanceid" /></div>
</ng-template>

<!-- 表格内容自定义 column为对应的自定义的columns 中的当前column值 data为当前单元格数据 index计数器-->
<ng-template #format let-column="column" let-data="data" let-index="index" let-value="value">
    <ng-container *ngIf="column.format=='toName'">
        <span *ngIf="column.tip" nz-tooltip [nzTooltipTitle]="value">
            <a (click)="toName(data)">{{value}}</a>
        </span>
        <span *ngIf="!column.tip">
            <a (click)="toName(data)">{{value}}</a>
        </span>
    </ng-container>
</ng-template>

<!-- 单独表格翻页控件 -->
<ng-template #tablePage>
    <nz-pagination [nzHideOnSinglePage]="false" (nzPageIndexChange)="pageIndexChange($event)"
        (nzPageSizeChange)="pageSizeChange($event)" [nzPageIndex]="queryParams.page" [nzTotal]="total" nzShowSizeChanger
        [nzPageSize]="queryParams.pageSize" [nzShowTotal]="totalTemplate" nzSize="small" nzShowQuickJumper>
    </nz-pagination>
    <ng-template #totalTemplate let-total>{{ 'placard.totalnum'|i18n| covertTranslation: total }}</ng-template>
</ng-template>

<!-- 弹窗 -------------------------------------------------------->
<zpopup [popupTitle]="zpopupTiele" *ngIf="isPopup" [isLoading]="isLoading" [width]="1000" [height]="650"
    (getClosePopup)="closePopup()" [zpopupCont]="zpopupCont" [zpopupFoot]="zpopupFoot"></zpopup>
<!-- 弹窗 内容 -->
<ng-template #zpopupCont>
    <form nz-form [formGroup]="validateForm">
        <div class="cont_title">{{'popupField.title1'|i18n}}</div>
        <div class="cont_img">
            <div class="left">
                <div nz-row [nzGutter]="24">
                    <div nz-col [nzSpan]="24">
                        <nz-form-item>
                            <!-- 部门 -->
                            <nz-form-label style="width: 70px;">{{'popupField.department'|i18n}}</nz-form-label>
                            <nz-form-control>
                                <nz-tree-select style="width: 100%" [nzExpandedKeys]="treeSelectExpandKeys"
                                    [nzNodes]="treeSelectNodes" nzShowSearch
                                    nzPlaceHolder="{{'popupField.department'|i18n}}"
                                    [nzDropdownStyle]="{ 'max-height': '300px' }" formControlName="hoi_key">
                                </nz-tree-select>
                            </nz-form-control>
                        </nz-form-item>
                    </div>
                </div>
                <div nz-row [nzGutter]="24">
                    <div nz-col [nzSpan]="12">
                        <nz-form-item>
                            <!-- 工号 -->
                            <nz-form-label style="width: 70px;" nzRequired nzFor="code">{{'popupField.jobNo'|i18n}}
                            </nz-form-label>
                            <nz-form-control nzErrorTip="">
                                <input type="text" nz-input formControlName="code" [placeholder]="'inputdata.input'|i18n" />
                            </nz-form-control>
                        </nz-form-item>
                    </div>
                    <div nz-col [nzSpan]="12">
                        <nz-form-item>
                            <!-- 名称 -->
                            <nz-form-label style="width: 54px;" nzRequired nzFor="name">{{'popupField.realName'|i18n}}
                            </nz-form-label>
                            <nz-form-control>
                                <input type="text" nz-input formControlName="name" [placeholder]="'inputdata.input'|i18n" />
                            </nz-form-control>
                        </nz-form-item>
                    </div>
                </div>
                <div nz-row [nzGutter]="24">
                    <div nz-col [nzSpan]="12">
                        <nz-form-item>
                            <!-- 身份证 -->
                            <nz-form-label style="width: 70px;" nzFor="idnumber">{{'popupField.idcard'|i18n}}
                            </nz-form-label>
                            <nz-form-control nzErrorTip="">
                                <input type="text" nz-input formControlName="idnumber" [placeholder]="'inputdata.input'|i18n" />
                            </nz-form-control>
                        </nz-form-item>
                    </div>
                    <div nz-col [nzSpan]="12">
                        <nz-form-item>
                            <!-- 性别 -->
                            <nz-form-label style="width: 54px;" nzFor="sex">{{'popupField.sex'|i18n}}</nz-form-label>
                            <nz-form-control>
                                <nz-select style="width: 100%;" nzShowSearch nzAllowClear [nzPlaceHolder]="'checkdata.check'|i18n"
                                    formControlName="sex">
                                    <nz-option *ngFor="let item of sexList" [nzLabel]="item.name" [nzValue]="item.name">
                                    </nz-option>
                                </nz-select>
                            </nz-form-control>
                        </nz-form-item>
                    </div>
                </div>
            </div>
            <div class="right">
                <nz-upload class="avatar-uploader img" [nzAction]="employeeService.getUpAcatarUrl()" nzName="avatar"
                    nzListType="picture-card" [nzShowUploadList]="false" [nzBeforeUpload]="beforeUpload" [nzHeaders]="uploadingHeader()"
                    (nzChange)="handleChange($event)">
                    <ng-container *ngIf="!avatarUrl">
                        <i class="upload-icon" nz-icon [nzType]="loading ? 'loading' : 'plus'"></i>
                        <div class="ant-upload-text">{{'popupField.picture'|i18n}}</div>
                    </ng-container>
                    <img *ngIf="avatarUrl" [src]="avatarUrl" style="width: 126px;height: 126px;" />
                </nz-upload>
            </div>
        </div>
        <div class="cont">
            <div nz-row [nzGutter]="24">
                <div nz-col [nzSpan]="8">
                    <nz-form-item>
                        <!-- 工种 -->
                        <nz-form-label style="width: 70px;" nzFor="worktype">{{'popupField.profession'|i18n}}
                        </nz-form-label>
                        <nz-form-control nzErrorTip="">
                            <nz-select style="width: 100%;" nzAllowClear [nzPlaceHolder]="'checkdata.check'|i18n" formControlName="worktype">
                                <nz-option *ngFor="let item of worktypeList" [nzLabel]="item.name"
                                    [nzValue]="item.name"></nz-option>
                            </nz-select>
                        </nz-form-control>
                    </nz-form-item>
                </div>
                <div nz-col [nzSpan]="8">
                    <nz-form-item>
                        <!-- 入职时间 -->
                        <nz-form-label style="width: 70px;" nzFor="employmentdate">{{'popupField.entryTime'|i18n}}
                        </nz-form-label>
                        <nz-form-control>
                            <nz-date-picker style="width: 100%;" formControlName="employmentdate"></nz-date-picker>
                        </nz-form-control>
                    </nz-form-item>
                </div>
                <div nz-col [nzSpan]="8">
                    <nz-form-item>
                        <!-- 离职时间 -->
                        <nz-form-label style="width: 70px;" nzFor="resignationdate">{{'popupField.outTime'|i18n}}
                        </nz-form-label>
                        <nz-form-control>
                            <nz-date-picker style="width: 100%;" formControlName="resignationdate"></nz-date-picker>
                        </nz-form-control>
                    </nz-form-item>
                </div>
            </div>
            <div nz-row [nzGutter]="24">
                <div nz-col [nzSpan]="8">
                    <nz-form-item>
                        <!-- 考勤卡号 -->
                        <nz-form-label style="width: 70px;" nzFor="attendanceid">{{'popupField.timeNo'|i18n}}
                        </nz-form-label>
                        <nz-form-control nzErrorTip="">
                            <input type="text" nz-input formControlName="attendanceid" [placeholder]="'inputdata.input'|i18n" />
                        </nz-form-control>
                    </nz-form-item>
                </div>
                <div nz-col [nzSpan]="8">
                    <nz-form-item>
                        <!-- 工资卡号 -->
                        <nz-form-label style="width: 70px;" nzFor="cardnumber">{{'popupField.payrollNo'|i18n}}
                        </nz-form-label>
                        <nz-form-control>
                            <input type="text" nz-input formControlName="cardnumber" [placeholder]="'inputdata.input'|i18n" />
                        </nz-form-control>
                    </nz-form-item>
                </div>
                <div nz-col [nzSpan]="8">
                    <nz-form-item>
                        <!-- 联系方式 -->
                        <nz-form-label style="width: 70px;" nzFor="phone">{{'popupField.phone'|i18n}}</nz-form-label>
                        <nz-form-control>
                            <input type="text" nz-input formControlName="phone" [placeholder]="'inputdata.input'|i18n" />
                        </nz-form-control>
                    </nz-form-item>
                </div>
            </div>
            <div nz-row [nzGutter]="24">
                <div nz-col [nzSpan]="24">
                    <nz-form-item>
                        <!-- 联系地址 -->
                        <nz-form-label style="width: 70px;" nzFor="address">{{'popupField.address'|i18n}}
                        </nz-form-label>
                        <nz-form-control>
                            <input type="text" nz-input formControlName="address" [placeholder]="'inputdata.input'|i18n" />
                        </nz-form-control>
                    </nz-form-item>
                </div>
            </div>
        </div>
        <div class="cont_title">{{'popupField.title2'|i18n}}</div>
        <div class="cont" style="height: 270px; margin-top: 20px;">
            <div nz-row [nzGutter]="24">
                <div nz-col [nzSpan]="8">
                    <nz-form-item>
                        <!-- 出生年月 -->
                        <nz-form-label style="width: 70px;" nzFor="birthday">{{'popupField.birthday'|i18n}}
                        </nz-form-label>
                        <nz-form-control nzErrorTip="">
                            <nz-date-picker style="width: 100%;" formControlName="birthday"></nz-date-picker>
                        </nz-form-control>
                    </nz-form-item>
                </div>
                <div nz-col [nzSpan]="8">
                    <nz-form-item>
                        <!-- 年龄 -->
                        <nz-form-label style="width: 70px;" nzFor="age">{{'popupField.age'|i18n}}</nz-form-label>
                        <nz-form-control>
                            <nz-input-number style="width: 100%;" formControlName="age" [nzMin]="1" [nzMax]="100"
                                [nzStep]="1" [nzPrecision]="0" [nzPlaceHolder]="'inputdata.input'|i18n"></nz-input-number>
                        </nz-form-control>
                    </nz-form-item>
                </div>
                <div nz-col [nzSpan]="8">
                    <nz-form-item>
                        <!-- 民族 -->
                        <nz-form-label style="width: 70px;" nzFor="nation">{{'popupField.family'|i18n}}</nz-form-label>
                        <nz-form-control>
                            <nz-select style="width: 100%;" nzAllowClear [nzPlaceHolder]="'checkdata.check'|i18n" formControlName="nation">
                                <nz-option *ngFor="let item of nationList" [nzLabel]="item.name" [nzValue]="item.name">
                                </nz-option>
                            </nz-select>
                        </nz-form-control>
                    </nz-form-item>
                </div>
            </div>
            <div nz-row [nzGutter]="24">
                <div nz-col [nzSpan]="8">
                    <nz-form-item>
                        <!-- 文化程度 -->
                        <nz-form-label style="width: 70px;" nzFor="education">{{'popupField.education'|i18n}}
                        </nz-form-label>
                        <nz-form-control nzErrorTip="">
                            <nz-select style="width: 100%;" nzAllowClear [nzPlaceHolder]="'checkdata.check'|i18n" formControlName="education">
                                <nz-option *ngFor="let item of educationList" [nzLabel]="item.name"
                                    [nzValue]="item.name"></nz-option>
                            </nz-select>
                        </nz-form-control>
                    </nz-form-item>
                </div>
                <div nz-col [nzSpan]="8">
                    <nz-form-item>
                        <!-- 婚姻 -->
                        <nz-form-label style="width: 70px;" nzFor="wedded">{{'popupField.marriage'|i18n}}
                        </nz-form-label>
                        <nz-form-control>
                            <nz-select style="width: 100%;" nzAllowClear [nzPlaceHolder]="'checkdata.check'|i18n" formControlName="wedded">
                                <nz-option *ngFor="let item of marriageList" [nzLabel]="item.name"
                                    [nzValue]="item.name"></nz-option>
                            </nz-select>
                        </nz-form-control>
                    </nz-form-item>
                </div>
                <div nz-col [nzSpan]="8">
                    <nz-form-item>
                        <!-- 身高 -->
                        <nz-form-label style="width: 70px;" nzFor="height">{{'popupField.height'|i18n}}</nz-form-label>
                        <nz-form-control>
                            <input type="text" nz-input formControlName="height" [placeholder]="'inputdata.input'|i18n" />
                        </nz-form-control>
                    </nz-form-item>
                </div>
            </div>
            <div nz-row [nzGutter]="24">
                <div nz-col [nzSpan]="8">
                    <nz-form-item>
                        <!-- 体重 -->
                        <nz-form-label style="width: 70px;" nzFor="weight">{{'popupField.weight'|i18n}}</nz-form-label>
                        <nz-form-control>
                            <input type="text" nz-input formControlName="weight" [placeholder]="'inputdata.input'|i18n" />
                        </nz-form-control>
                    </nz-form-item>
                </div>
            </div>
            <div nz-row [nzGutter]="24">
                <div nz-col [nzSpan]="24">
                    <nz-form-item>
                        <!-- 备注 -->
                        <nz-form-label style="width: 70px;" nzFor="remark">{{'popupField.remarks'|i18n}}</nz-form-label>
                        <nz-form-control>
                            <textarea rows="4" nz-input formControlName="remark"></textarea>
                        </nz-form-control>
                    </nz-form-item>
                </div>
            </div>
        </div>
    </form>
</ng-template>
<!-- 弹窗 底部按钮 -->
<ng-template #zpopupFoot>
    <button *ngIf="popupType=='add'" nz-button nzType="primary" [nzLoading]="isLoading"
        (click)="submit()">{{ 'btn.determine'|i18n }}</button>
    <button *ngIf="popupType=='update'" nz-button nzType="primary" [nzLoading]="isLoading"
        (click)="submit()">{{ 'btn.determine'|i18n }}</button>
</ng-template>

<!-- 用户管理 ----------------------------------------------->
<zpopup 
[popupTitle]="zpopupTiele" 
*ngIf="isPopupRole" 
[isLoading]="isRoleLoading" 
[width]="1000" 
[height]="650"
(getClosePopup)="closePopup()" 
[zpopupCont]="zpopupRoleCont" 
[zpopupFoot]="zpopupRoleFoot">
</zpopup>
<ng-template #zpopupRoleCont>
    <form nz-form [formGroup]="roleValidateForm">
        <div class="role_field">
            <div nz-row [nzGutter]="24">
                <div nz-col [nzSpan]="12">
                    <nz-form-item>
                        <!-- 用户名 -->
                        <nz-form-label style="width: 70px;" nzRequired nzFor="username">{{'popupField.username'|i18n}}
                        </nz-form-label>
                        <nz-form-control nzErrorTip="">
                            <input type="text" nz-input formControlName="username" placeholder="" />
                        </nz-form-control>
                    </nz-form-item>
                </div>
                <div nz-col [nzSpan]="12">
                    <nz-form-item>
                        <!-- 密码 -->
                        <nz-form-label style="width: 70px;" nzRequired nzFor="password">{{'popupField.password'|i18n}}
                        </nz-form-label>
                        <nz-form-control>
                            <nz-input-group [nzSuffix]="suffixTemplate">
                                <input [type]="passwordVisible ? 'text' : 'password'" nz-input placeholder=""
                                    formControlName="password" />
                            </nz-input-group>
                            <ng-template #suffixTemplate>
                                <i nz-icon [nzType]="passwordVisible ? 'eye-invisible' : 'eye'"
                                    (click)="passwordVisible = !passwordVisible"></i>
                            </ng-template>
                        </nz-form-control>
                    </nz-form-item>
                </div>
            </div>
            <div nz-row [nzGutter]="24">
                <div nz-col [nzSpan]="12">
                    <nz-form-item>
                        <!-- 到期时间 -->
                        <nz-form-label style="width: 70px;" nzFor="expiredate">{{'popupField.expirationTime'|i18n}}
                        </nz-form-label>
                        <nz-form-control nzErrorTip="">
                            <nz-date-picker style="width: 100%;" formControlName="expiredate"></nz-date-picker>
                        </nz-form-control>
                    </nz-form-item>
                </div>
                <div nz-col [nzSpan]="12">
                    <nz-form-item>
                        <!-- 是否禁用 -->
                        <nz-form-label style="width: 70px;" nzFor="disable">{{'popupField.isUse'|i18n}}</nz-form-label>
                        <nz-form-control>
                            <nz-select style="width: 100%;" nzAllowClear nzPlaceHolder="" formControlName="disable">
                                <nz-option [nzLabel]="'format.yes'|i18n" [nzValue]="1"></nz-option>
                                <nz-option [nzLabel]="'format.no'|i18n" [nzValue]="0"></nz-option>
                            </nz-select>
                        </nz-form-control>
                    </nz-form-item>
                </div>
            </div>
        </div>
    </form>
    <div class="tabs">
        <nz-tabset>
            <nz-tab [nzTitle]="'btn.roletab'|i18n">
                <div class="tabs_left">
                    <nz-table #roleLeftTable [nzPageSize]="9999999" [nzData]="roleDataLeft" [nzShowPagination]="false"
                        [nzBordered]="true" nzSize="small" [nzLoading]="roleLeftLoading" [nzScroll]="{y:'288px'}">
                        <thead>
                            <tr>
                                <!-- 序号 -->
                                <th nzWidth="46px" nzAlign="center">{{'popupField.sort_num'|i18n}}</th>
                                <!-- 角色名称 -->
                                <th>{{'popupField.role'|i18n}}</th>
                                <!-- 操作 -->
                                <th nzWidth="46px" nzAlign="center">{{'btn.operation'|i18n}}</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let data of roleLeftTable.data,let i = index">
                                <td nzAlign="center">{{ i + 1 }}</td>
                                <td>{{data.sri_name}}</td>
                                <td nzAlign="center">
                                    <a nz-button nzSize="small" nzType="link" (click)="roleAdd(data)">
                                        <i nz-icon nzType="plus" nzTheme="outline"></i>
                                    </a>
                                </td>
                            </tr>
                        </tbody>
                    </nz-table>
                </div>
                <div class="tabs_right">
                    <nz-table #roleRightTable [nzPageSize]="9999999" [nzData]="roleDataRight" [nzShowPagination]="false"
                        [nzBordered]="true" nzSize="small" [nzLoading]="roleRightLoading" [nzScroll]="{y:'288px'}">
                        <thead>
                            <tr>
                                <!-- 序号 -->
                                <th nzWidth="46px" nzAlign="center">{{'popupField.sort_num'|i18n}}</th>
                                <!-- 角色名称 -->
                                <th>{{'popupField.role'|i18n}}</th>
                                <!-- 操作 -->
                                <th nzWidth="46px" nzAlign="center">{{'btn.operation'|i18n}}</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let data of roleRightTable.data,let i = index">
                                <td nzAlign="center">{{ i + 1 }}</td>
                                <td>{{data.sri_name}}</td>
                                <td nzAlign="center">
                                    <!-- <a class="tabs_a" *ngIf="toRoleIsDel(data)" nz-popconfirm
                                        [nzPopconfirmTitle]="'confirm.confirm_remove'|i18n"
                                        (nzOnConfirm)="roleDel(data)">-</a> -->
                                        <a nz-button nzSize="small" nzType="link" *ngIf="toRoleIsDel(data)" nz-popconfirm
                                        [nzPopconfirmTitle]="'confirm.confirm_remove'|i18n"
                                        (nzOnConfirm)="roleDel(data)">
                                            <i nz-icon nzType="minus" nzTheme="outline"></i>
                                        </a>
                                </td>
                            </tr>
                        </tbody>
                    </nz-table>
                </div>
            </nz-tab>
            <nz-tab [nzTitle]="'btn.workshopSection'|i18n">
                <div class="tabs_left">
                    <nz-table #worksectionLeftTable [nzPageSize]="9999999" [nzData]="worksectionDataLeft"
                        [nzShowPagination]="false" [nzBordered]="true" nzSize="small"
                        [nzLoading]="worksectionLeftLoading" [nzScroll]="{y:'288px'}">
                        <thead>
                            <tr>
                                <!-- 序号 -->
                                <th nzWidth="46px" nzAlign="center">{{'popupField.sort_num'|i18n}}</th>
                                <!-- 角色名称 -->
                                <th>{{'popupField.role'|i18n}}</th>
                                <!-- 操作 -->
                                <th nzWidth="46px" nzAlign="center">{{'btn.operation'|i18n}}</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let data of worksectionLeftTable.data,let i = index">
                                <td nzAlign="center">{{ i + 1 }}</td>
                                <td>{{data.name}}</td>
                                <td nzAlign="center">
                                    <!-- <a class="tabs_a" (click)="worksectionAdd(data)">+</a> -->
                                    <a nz-button nzSize="small" nzType="link" (click)="worksectionAdd(data)">
                                        <i nz-icon nzType="plus" nzTheme="outline"></i>
                                    </a>
                                </td>
                            </tr>
                        </tbody>
                    </nz-table>
                </div>
                <div class="tabs_right">
                    <nz-table #worksectionRightTable [nzPageSize]="9999999" [nzData]="worksectionDataRight"
                        [nzShowPagination]="false" [nzBordered]="true" nzSize="small"
                        [nzLoading]="worksectionRightLoading" [nzScroll]="{y:'288px'}">
                        <thead>
                            <tr>
                                <!-- 序号 -->
                                <th nzWidth="46px" nzAlign="center">{{'popupField.sort_num'|i18n}}</th>
                                <!-- 角色名称 -->
                                <th>{{'popupField.role'|i18n}}</th>
                                <!-- 操作 -->
                                <th nzWidth="46px" nzAlign="center">{{'btn.operation'|i18n}}</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let data of worksectionRightTable.data,let i = index">
                                <td nzAlign="center">{{ i + 1 }}</td>
                                <td>{{data.bwi_name}}</td>
                                <td nzAlign="center">
                                    <!-- <a class="tabs_a" *ngIf="toWorksectionIsDel(data)" nz-popconfirm
                                        [nzPopconfirmTitle]="'confirm.confirm_remove'|i18n"
                                        (nzOnConfirm)="worksectionDel(data)">-</a> -->
                                        <a nz-button nzSize="small" nzType="link" *ngIf="toWorksectionIsDel(data)" nz-popconfirm
                                        [nzPopconfirmTitle]="'confirm.confirm_remove'|i18n"
                                        (nzOnConfirm)="worksectionDel(data)">
                                            <i nz-icon nzType="minus" nzTheme="outline"></i>
                                        </a>
                                </td>
                            </tr>
                        </tbody>
                    </nz-table>
                </div>
            </nz-tab>
        </nz-tabset>
    </div>
</ng-template>
<ng-template #zpopupRoleFoot>
    <button nz-button nzType="primary" [nzLoading]="isRoleLoading" (click)="submit()">{{ 'btn.enter'|i18n }}</button>
</ng-template>

<!-- 技能管理 ----------------------------------------------->
<zpopup 
[popupTitle]="zpopupTiele" 
*ngIf="isPopupSkill" 
[isLoading]="isSkillLoading" 
[width]="1000" [height]="650"
(getClosePopup)="closePopup()" 
[zpopupCont]="zpopupSkillCont" 
[zpopupFoot]="zpopupSkillFoot">
</zpopup>
<ng-template #zpopupSkillCont>
    <form nz-form [formGroup]="skillValidateForm">
        <div class="skill_field">
            <div nz-row [nzGutter]="24">
                <div nz-col [nzSpan]="24">
                    <nz-form-item>
                        <!-- 名称 -->
                        <nz-form-control>
                            <nz-select nzShowSearch nzServerSearch [isLoading]="isSkillUserListLoading"
                                style="width: 100%;" [nzPlaceHolder]="'popupField.name'|i18n" formControlName="name"
                                (nzOnSearch)="onSkillUserSearch($event)">
                                <nz-option *ngFor="let item of skillUserList" [nzLabel]="item.name+'['+item.code+']'"
                                    [nzValue]="item.key"></nz-option>
                            </nz-select>
                        </nz-form-control>
                    </nz-form-item>
                </div>
            </div>
        </div>
    </form>
    <div class="tabs">
        <div class="tabs_skill_left">
            <div class="tabs_skill_select">
                <nz-input-group nzSearch [nzAddOnAfter]="suffixIconButton">
                    <input type="text" nz-input [(ngModel)]="skillLeftSelect" placeholder="" />
                </nz-input-group>
                <ng-template #suffixIconButton>
                    <button nz-button nzType="primary" nzSearch (click)="toLoginSkill()"><i nz-icon
                            nzType="search"></i></button>
                </ng-template>
            </div>
            <div class="tabs_skill_table">
                <nz-table #skillLeftTable [nzScroll]="{y:'330px'}" [nzData]="skillDataLeft" [nzShowPagination]="false"
                    [nzBordered]="true" nzSize="small" [nzLoading]="skillLeftLoading">
                    <thead>
                        <tr>
                            <!-- 序号 -->
                            <th nzWidth="70px" nzAlign="center">{{'popupField.sort_num'|i18n}}</th>
                            <!-- 工序名称 -->
                            <th>{{'popupField.processName'|i18n}}</th>
                            <!-- 工序编号 -->
                            <th>{{'popupField.processNo'|i18n}}</th>
                            <!-- 操作 -->
                            <th nzWidth="46px" nzAlign="center">{{'btn.operation'|i18n}}</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let data of skillLeftTable.data,let i = index">
                            <td nzAlign="center">{{ i + 1 }}</td>
                            <td>{{data.name}}</td>
                            <td>{{data.code}}</td>
                            <td nzAlign="center">
                                <!-- <a class="tabs_a">+</a> -->
                                <a nz-button nzSize="small" nzType="link" >
                                    <i nz-icon nzType="plus" nzTheme="outline"></i>
                                </a>
                            </td>
                        </tr>
                    </tbody>
                </nz-table>
            </div>
            <div class="tabs_skill_page">
                <div class="tabs_skill_page_in">
                    <nz-pagination [(nzPageIndex)]="skillPage" [nzTotal]="skillTotal" [nzSize]="'small'"
                        [nzShowTotal]="totalSkillTemplate" (nzPageIndexChange)="pageIndexSkillChange($event)">
                    </nz-pagination>
                    <ng-template #totalSkillTemplate let-total>{{'placard.totalnum'|i18n:skillTotal}}</ng-template>
                </div>
            </div>
        </div>
        <div class="tabs_skill_right">
            <div class="tabs_skill_select">
                <nz-input-group nzSearch [nzAddOnAfter]="suffixIconButton">
                    <input type="text" nz-input [(ngModel)]="skillRightSelect" placeholder="" />
                </nz-input-group>
                <ng-template #suffixIconButton>
                    <button nz-button nzType="primary" nzSearch (click)="toUserSkill()"><i nz-icon
                            nzType="search"></i></button>
                </ng-template>
            </div>
            <div class="tabs_skill_table">
                <nz-table #skillRightTable [nzScroll]="{y:'330px'}" [nzData]="skillDataRight" [nzShowPagination]="false"
                    [nzBordered]="true" nzSize="small" [nzLoading]="skillRightLoading">
                    <thead>
                        <tr>
                            <!-- 序号 -->
                            <th nzWidth="70px" nzAlign="center">{{'popupField.sort_num'|i18n}}</th>
                            <!-- 工序名称 -->
                            <th>{{'popupField.processName'|i18n}}</th>
                            <!-- 工序编号 -->
                            <th>{{'popupField.processNo'|i18n}}</th>
                            <!-- 操作 -->
                            <th nzWidth="46px" nzAlign="center">{{'btn.operation'|i18n}}</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let data of skillRightTable.data,let i = index">
                            <td nzAlign="center">{{ i + 1 }}</td>
                            <td>{{data.name}}</td>
                            <td>{{data.code}}</td>
                            <td nzAlign="center">
                                <a class="tabs_a"><i nz-icon nzType="minus" nzTheme="outline"></i></a>
                                <!-- <a nz-button nzSize="small" nzType="link" *ngIf="toWorksectionIsDel(data)" nz-popconfirm
                                        [nzPopconfirmTitle]="'confirm.confirm_remove'|i18n"
                                        (nzOnConfirm)="worksectionDel(data)">
                                            <i nz-icon nzType="minus" nzTheme="outline"></i>
                                        </a> -->
                            </td>
                        </tr>
                    </tbody>
                </nz-table>
            </div>
            <div class="tabs_skill_page">
                <div class="tabs_skill_page_in">
                    <nz-pagination [(nzPageIndex)]="skillRightPage" [nzTotal]="skillRightTotal" [nzSize]="'small'"
                        [nzShowTotal]="totalRightSkillTemplate" (nzPageIndexChange)="pageIndexUserSkillChange($event)">
                    </nz-pagination>
                    <ng-template #totalRightSkillTemplate let-total>{{'placard.totalnum'|i18n:skillRightTotal}}</ng-template>
                </div>
            </div>
        </div>
    </div>
</ng-template>
<ng-template #zpopupSkillCont>
    <button nz-button nzType="primary" [nzLoading]="isSkillLoading" (click)="submit()">{{ 'btn.enter'|i18n }}</button>
</ng-template>

<!-- 设备权限---------------------------------------------------->
<zpopup 
[popupTitle]="zpopupTiele" 
*ngIf="isPopupAuthority" 
[isLoading]="isAuthorityLoading" 
[width]="1000" [height]="650"
(getClosePopup)="closePopup()" 
[zpopupCont]="zpopupAuthorityCont" 
[zpopupFoot]="zpopupAuthorityFoot">
</zpopup>
<ng-template #zpopupAuthorityCont>
    <div class="tabs">
        <nz-tabset (nzSelectChange)="authorityTabChange($event)">
            <nz-tab [nzTitle]="'popupField.uploadStation'|i18n">
                <div class="tabs_left">
                    <nz-table #uploadStationLeftTable [nzPageSize]="9999999" [nzData]="uploadStationDataLeft" [nzShowPagination]="false"
                        [nzBordered]="true" nzSize="small" [nzLoading]="uploadStationLeftLoading" [nzScroll]="{y:'410px'}">
                        <thead>
                            <tr>
                                <!-- 序号 -->
                                <th nzWidth="46px" nzAlign="center">{{'popupField.sort_num'|i18n}}</th>
                                <!-- 上载站名称 -->
                                <th>{{'popupField.uploadStation'|i18n}}</th>
                                <!-- 操作 -->
                                <th nzWidth="46px" nzAlign="center">{{'btn.operation'|i18n}}</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let data of uploadStationLeftTable.data,let i = index">
                                <td nzAlign="center">{{ i + 1 }}</td>
                                <td>{{data.name + '['+data.code+']'}}</td>
                                <td nzAlign="center">
                                    <a nz-button nzSize="small" nzType="link" (click)="uploadStationAdd(data)">
                                        <i nz-icon nzType="plus" nzTheme="outline"></i>
                                    </a>
                                </td>
                            </tr>
                        </tbody>
                    </nz-table>
                </div>
                <div class="tabs_right">
                    <nz-table #uploadStationRightTable [nzPageSize]="9999999" [nzData]="uploadStationDataRight" [nzShowPagination]="false"
                        [nzBordered]="true" nzSize="small" [nzLoading]="uploadStationRightLoading" [nzScroll]="{y:'410px'}">
                        <thead>
                            <tr>
                                <!-- 序号 -->
                                <th nzWidth="46px" nzAlign="center">{{'popupField.sort_num'|i18n}}</th>
                                <!-- 上载站 -->
                                <th>{{'popupField.uploadStation'|i18n}}</th>
                                <!-- 操作 -->
                                <th nzWidth="46px" nzAlign="center">{{'btn.operation'|i18n}}</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let data of uploadStationRightTable.data,let i = index">
                                <td nzAlign="center">{{ i + 1 }}</td>
                                <td>{{data.station_name + '['+data.station_code+']'}}</td>
                                <td nzAlign="center">
                                    <!-- <a class="tabs_a" *ngIf="toRoleIsDel(data)" nz-popconfirm
                                        [nzPopconfirmTitle]="'confirm.confirm_remove'|i18n"
                                        (nzOnConfirm)="roleDel(data)">-</a> -->
                                        <a nz-button nzSize="small" nzType="link" nz-popconfirm
                                        [nzPopconfirmTitle]="'confirm.confirm_remove'|i18n"
                                        (nzOnConfirm)="uploadStationDel(data)">
                                            <i nz-icon nzType="minus" nzTheme="outline"></i>
                                        </a>
                                </td>
                            </tr>
                        </tbody>
                    </nz-table>
                </div>
            </nz-tab>
            <nz-tab [nzTitle]="'popupField.hangLine'|i18n">
                <div class="tabs_left">
                    <nz-table #hangLineLeftTable [nzPageSize]="9999999" [nzData]="hangLineDataLeft"
                        [nzShowPagination]="false" [nzBordered]="true" nzSize="small"
                        [nzLoading]="hangLineLeftLoading" [nzScroll]="{y:'410px'}">
                        <thead>
                            <tr>
                                <!-- 序号 -->
                                <th nzWidth="46px" nzAlign="center">{{'popupField.sort_num'|i18n}}</th>
                                <!-- 吊挂实体线名称 -->
                                <th>{{'popupField.hangLine'|i18n}}</th>
                                <!-- 操作 -->
                                <th nzWidth="46px" nzAlign="center">{{'btn.operation'|i18n}}</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let data of hangLineLeftTable.data,let i = index">
                                <td nzAlign="center">{{ i + 1 }}</td>
                                <td>{{data.name+ '['+data.code+']'}}</td>
                                <td nzAlign="center">
                                    <!-- <a class="tabs_a" (click)="worksectionAdd(data)">+</a> -->
                                    <a nz-button nzSize="small" nzType="link" (click)="hangLineAdd(data)">
                                        <i nz-icon nzType="plus" nzTheme="outline"></i>
                                    </a>
                                </td>
                            </tr>
                        </tbody>
                    </nz-table>
                </div>
                <div class="tabs_right">
                    <nz-table #hangLineRightTable [nzPageSize]="9999999" [nzData]="hangLineDataRight"
                        [nzShowPagination]="false" [nzBordered]="true" nzSize="small"
                        [nzLoading]="hangLineRightLoading" [nzScroll]="{y:'410px'}">
                        <thead>
                            <tr>
                                <!-- 序号 -->
                                <th nzWidth="46px" nzAlign="center">{{'popupField.sort_num'|i18n}}</th>
                                <!-- 吊挂实体线名称 -->
                                <th>{{'popupField.hangLine'|i18n}}</th>
                                <!-- 操作 -->
                                <th nzWidth="46px" nzAlign="center">{{'btn.operation'|i18n}}</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let data of hangLineRightTable.data,let i = index">
                                <td nzAlign="center">{{ i + 1 }}</td>
                                <td>{{data.line_name + '['+data.line_code+']'}}</td>
                                <td nzAlign="center">
                                    <!-- <a class="tabs_a" *ngIf="toWorksectionIsDel(data)" nz-popconfirm
                                        [nzPopconfirmTitle]="'confirm.confirm_remove'|i18n"
                                        (nzOnConfirm)="worksectionDel(data)">-</a> -->
                                        <a nz-button nzSize="small" nzType="link" nz-popconfirm
                                        [nzPopconfirmTitle]="'confirm.confirm_remove'|i18n"
                                        (nzOnConfirm)="hangLineDel(data)">
                                            <i nz-icon nzType="minus" nzTheme="outline"></i>
                                        </a>
                                </td>
                            </tr>
                        </tbody>
                    </nz-table>
                </div>
            </nz-tab>
            <nz-tab [nzTitle]="'popupField.hangVirtuallyLine'|i18n">
                <div class="tabs_left">
                    <nz-table #hangVirtuallyLineLeftTable [nzPageSize]="9999999" [nzData]="hangVirtuallyLineDataLeft"
                        [nzShowPagination]="false" [nzBordered]="true" nzSize="small"
                        [nzLoading]="hangVirtuallyLineLeftLoading" [nzScroll]="{y:'410px'}">
                        <thead>
                            <tr>
                                <!-- 序号 -->
                                <th nzWidth="46px" nzAlign="center">{{'popupField.sort_num'|i18n}}</th>
                                <!-- 吊挂虚拟线名称 -->
                                <th>{{'popupField.hangVirtuallyLine'|i18n}}</th>
                                <!-- 操作 -->
                                <th nzWidth="46px" nzAlign="center">{{'btn.operation'|i18n}}</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let data of hangVirtuallyLineLeftTable.data,let i = index">
                                <td nzAlign="center">{{ i + 1 }}</td>
                                <td>{{data.name + '['+data.code+']'}}</td>
                                <td nzAlign="center">
                                    <!-- <a class="tabs_a" (click)="worksectionAdd(data)">+</a> -->
                                    <a nz-button nzSize="small" nzType="link" (click)="hangVirtuallyLineAdd(data)">
                                        <i nz-icon nzType="plus" nzTheme="outline"></i>
                                    </a>
                                </td>
                            </tr>
                        </tbody>
                    </nz-table>
                </div>
                <div class="tabs_right">
                    <nz-table #hangVirtuallyLineRightTable [nzPageSize]="9999999" [nzData]="hangVirtuallyLineDataRight"
                        [nzShowPagination]="false" [nzBordered]="true" nzSize="small"
                        [nzLoading]="hangVirtuallyLineRightLoading" [nzScroll]="{y:'410px'}">
                        <thead>
                            <tr>
                                <!-- 序号 -->
                                <th nzWidth="46px" nzAlign="center">{{'popupField.sort_num'|i18n}}</th>
                                <!-- 吊挂虚拟线名称 -->
                                <th>{{'popupField.hangVirtuallyLine'|i18n}}</th>
                                <!-- 操作 -->
                                <th nzWidth="46px" nzAlign="center">{{'btn.operation'|i18n}}</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let data of hangVirtuallyLineRightTable.data,let i = index">
                                <td nzAlign="center">{{ i + 1 }}</td>
                                <td>{{data.bvl_name + '['+data.bvl_code+']'}}</td>
                                <td nzAlign="center">
                                    <!-- <a class="tabs_a" *ngIf="toWorksectionIsDel(data)" nz-popconfirm
                                        [nzPopconfirmTitle]="'confirm.confirm_remove'|i18n"
                                        (nzOnConfirm)="worksectionDel(data)">-</a> -->
                                        <a nz-button nzSize="small" nzType="link" nz-popconfirm
                                        [nzPopconfirmTitle]="'confirm.confirm_remove'|i18n"
                                        (nzOnConfirm)="hangVirtuallyLineDel(data)">
                                            <i nz-icon nzType="minus" nzTheme="outline"></i>
                                        </a>
                                </td>
                            </tr>
                        </tbody>
                    </nz-table>
                </div>
            </nz-tab>
        </nz-tabset>
    </div>
</ng-template>
<ng-template #zpopupAuthorityCont>
    <button nz-button nzType="primary" [nzLoading]="isAuthorityLoading" (click)="submit()">{{ 'btn.enter'|i18n }}</button>
</ng-template>

<!-- 删除---------------------------------------------------->
<zpopup-confirm *ngIf="isPopupConfirm" [delDataNum]="delDataNum" (getClosePopup)="closePopup()"
    [zpopupConfirmFoot]="zpopupConfirmFoot">
</zpopup-confirm>
<!-- 弹窗 底部按钮 -->
<ng-template #zpopupConfirmFoot>
    <button nz-button nzType="primary" [nzLoading]="isLoading" (click)="submit()">{{ 'btn.determine'|i18n }}</button>
</ng-template>

<!-- 导入 ---------------------------------------------------->
<zpopup [popupTitle]="zpopupTiele" *ngIf="isPopupImport" [width]="700" [height]="400" (getClosePopup)="closePopup()"
    [zpopupCont]="zpopupImportCont" [zpopupFoot]="zpopupImportFoot">
</zpopup>
<!-- 导入 内容 -->
<ng-template #zpopupImportCont>
    <div class="down"><button nz-button nzType="dashed" (click)="toExcelModel()">{{ 'btn.downmodel'|i18n }}</button>
        <span style="padding-left: 10px;">{{ 'checkdata.downTip'|i18n }}</span></div>
    <div class="import">
        <nz-upload nzType="drag" [nzMultiple]="true" [nzAction]="upExcel()" [nzHeaders]="uploadingHeader()"
            (nzChange)="importChange($event)" [nzBeforeUpload]="beforeUploadExcel" [nzMultiple]="false"
            [nzDisabled]="isUpload">
            <p class="ant-upload-drag-icon">
                <i nz-icon nzType="inbox"></i>
            </p>
            <p class="ant-upload-text">{{ 'warning.importTip'|i18n }}</p>
            <p class="ant-upload-hint">
                {{ 'warning.importTip2'|i18n }}
            </p>
        </nz-upload>
    </div>
</ng-template>
<!-- 导入 底部 -->
<ng-template #zpopupImportFoot>

</ng-template>

<!-- 员工详情 -->
<userpopup *ngIf="isPopupUser" [isLoading]="isUserLoading" [userData]="userData" (getClosePopup)="closePopup()">
</userpopup>

<!-- 同步用户信息 ---------------------------------------------------->
<zpopup-confirm *ngIf="isPopupSyncConfirm" [type]="1" [text]="syncText" (getClosePopup)="closePopup()"
    [zpopupConfirmFoot]="zpopupSyncConfirmFoot">
</zpopup-confirm>
<!-- 弹窗 底部按钮 -->
<ng-template #zpopupSyncConfirmFoot>
    <button nz-button nzType="primary" [nzLoading]="isSyncLoading"
        (click)="toSync()">{{ 'btn.determine'|i18n }}</button>
</ng-template>
